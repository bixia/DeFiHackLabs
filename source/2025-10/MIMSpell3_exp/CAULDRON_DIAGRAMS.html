<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cauldron V4 ä¸šåŠ¡é€»è¾‘å›¾ - å¯è§†åŒ–</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        h2 {
            color: #764ba2;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-top: 50px;
        }
        .diagram {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .description {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .danger {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .toc {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc li {
            padding: 8px 0;
        }
        .toc a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }
        .toc a:hover {
            color: #764ba2;
            text-decoration: underline;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .legend {
            background: #fff;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        .legend-item {
            display: inline-block;
            margin: 5px 15px;
        }
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            border-radius: 3px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¦ Cauldron V4 ä¸šåŠ¡é€»è¾‘å›¾</h1>
        <p class="subtitle">åŸºäºå®é™…åˆçº¦æºä»£ç çš„æ·±åº¦åˆ†æ | MIMSpell3 æ”»å‡»æ¡ˆä¾‹ç ”ç©¶</p>

        <div class="legend">
            <strong>å›¾ä¾‹è¯´æ˜ï¼š</strong>
            <div class="legend-item">
                <span class="legend-color" style="background: #90EE90;"></span>
                <span>æ­£å¸¸æµç¨‹/æˆåŠŸ</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #FF6B6B;"></span>
                <span>é”™è¯¯/æ”»å‡»/å¤±è´¥</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #FFD700;"></span>
                <span>å…³é”®æ£€æŸ¥ç‚¹/è­¦å‘Š</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #87CEEB;"></span>
                <span>ç³»ç»Ÿç»„ä»¶</span>
            </div>
        </div>

        <div class="toc">
            <h3>ğŸ“‘ ç›®å½•</h3>
            <ul>
                <li><a href="#architecture">1. ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ</a></li>
                <li><a href="#cook-flow">2. Cookå‡½æ•°å·¥ä½œæµç¨‹</a></li>
                <li><a href="#borrow-flow">3. å€Ÿæ¬¾æµç¨‹è¯¦è§£</a></li>
                <li><a href="#solvency">4. Solvencyæ£€æŸ¥æœºåˆ¶</a></li>
                <li><a href="#attack">5. æ”»å‡»å‘é‡åˆ†æ</a></li>
                <li><a href="#repay">6. è¿˜æ¬¾æµç¨‹</a></li>
                <li><a href="#comparison">7. æ­£å¸¸vsæ”»å‡»åœºæ™¯å¯¹æ¯”</a></li>
            </ul>
        </div>

        <div class="danger">
            <strong>âš ï¸ å®‰å…¨è­¦å‘Šï¼š</strong> æœ¬æ–‡æ¡£å±•ç¤ºçš„æ˜¯çœŸå®çš„DeFiå®‰å…¨æ¼æ´æ¡ˆä¾‹ã€‚è¿™6ä¸ªCauldronåˆçº¦å› é…ç½®é”™è¯¯å¯¼è‡´$1.7MæŸå¤±ã€‚è¯·ä»…ç”¨äºå­¦ä¹ å’Œå®‰å…¨ç ”ç©¶ç›®çš„ã€‚
        </div>

        <h2 id="architecture">1. ğŸ“Š ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ</h2>
        <div class="description">
            Cauldron V4 æ˜¯ä¸€ä¸ªå€Ÿè´·åè®®åˆçº¦ï¼Œç”¨æˆ·å¯ä»¥å­˜å…¥æŠµæŠ¼å“ï¼ˆCollateralï¼‰å€Ÿå‡ºMIMç¨³å®šå¸ã€‚æ‰€æœ‰èµ„é‡‘éƒ½æ‰˜ç®¡åœ¨BentoBoxåˆçº¦ä¸­ï¼Œé‡‡ç”¨shareæœºåˆ¶ç®¡ç†ä½™é¢ã€‚
        </div>
        <div class="diagram">
            <pre class="mermaid">
graph TB
    User[ğŸ‘¤ ç”¨æˆ·/æ”»å‡»è€…] --> Cauldron[ğŸ¦ Cauldron V4 åˆçº¦]
    Cauldron --> BentoBox[ğŸ’° BentoBox èµ„é‡‘æ± ]
    Cauldron --> Oracle[ğŸ“Š ä»·æ ¼é¢„è¨€æœº]
    BentoBox --> MIM[ğŸª™ MIM Token<br/>Magic Internet Money]
    BentoBox --> Collateral[ğŸ”’ æŠµæŠ¼å“ Token<br/>ETH/USDC/etc]
    
    style Cauldron fill:#f9f,stroke:#333,stroke-width:4px
    style BentoBox fill:#bbf,stroke:#333,stroke-width:2px
    style User fill:#bfb,stroke:#333,stroke-width:2px
    style MIM fill:#FFD700,stroke:#333,stroke-width:2px
    style Oracle fill:#FFA500,stroke:#333,stroke-width:2px
            </pre>
        </div>

        <h2 id="cook-flow">2. ğŸ”„ Cookå‡½æ•°å·¥ä½œæµç¨‹</h2>
        <div class="description">
            <code>cook()</code> æ˜¯Cauldronçš„æ ¸å¿ƒå‡½æ•°ï¼Œæ”¯æŒæ‰¹é‡æ‰§è¡Œå¤šç§æ“ä½œã€‚å®ƒæ¥å—ä¸€ä¸ªactionsæ•°ç»„ï¼Œä¾æ¬¡æ‰§è¡Œæ¯ä¸ªactionã€‚è¿™ç§è®¾è®¡æä¾›äº†çµæ´»æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†å®‰å…¨é£é™©ã€‚
        </div>
        <div class="warning">
            <strong>ğŸ”‘ å…³é”®ç‚¹ï¼š</strong> åªæœ‰ç‰¹å®šçš„actionsï¼ˆå¦‚BORROWã€REMOVE_COLLATERALï¼‰ä¼šè§¦å‘<code>needsSolvencyCheck</code>æ ‡å¿—ï¼Œåœ¨å‡½æ•°æœ€åæ‰ä¼šæ£€æŸ¥ç”¨æˆ·çš„æŠµæŠ¼å“æ˜¯å¦å……è¶³ã€‚
        </div>
        <div class="diagram">
            <pre class="mermaid">
flowchart TD
    Start[ğŸ¬ å¼€å§‹: cookè°ƒç”¨] --> Loop{ğŸ”„ éå†actionsæ•°ç»„}
    
    Loop -->|action < 10| Accrue[â° æ‰§è¡Œaccrueåˆ©æ¯ç´¯è®¡]
    Accrue --> CheckAction{ğŸ¯ åˆ¤æ–­actionç±»å‹}
    Loop -->|action >= 10| CheckAction
    
    CheckAction -->|10| AddCol[â• æ·»åŠ æŠµæŠ¼å“]
    CheckAction -->|2| Repay[ğŸ’¸ è¿˜æ¬¾]
    CheckAction -->|4| RemoveCol[â– ç§»é™¤æŠµæŠ¼å“]
    CheckAction -->|5| Borrow[ğŸ’° å€Ÿæ¬¾]
    CheckAction -->|20| BentoDep[ğŸ“¥ BentoBoxå­˜æ¬¾]
    CheckAction -->|21| BentoWith[ğŸ“¤ BentoBoxå–æ¬¾]
    
    AddCol --> NextAction[â¡ï¸ ç»§ç»­ä¸‹ä¸€ä¸ªaction]
    Repay --> NextAction
    RemoveCol --> SetCheck1[ğŸš¨ è®¾ç½®needsSolvencyCheck=true]
    Borrow --> SetCheck2[ğŸš¨ è®¾ç½®needsSolvencyCheck=true]
    BentoDep --> NextAction
    BentoWith --> NextAction
    
    SetCheck1 --> NextAction
    SetCheck2 --> NextAction
    
    NextAction --> Loop
    Loop -->|âœ… å®Œæˆæ‰€æœ‰actions| SolvencyCheck{â“ needsSolvencyCheck?}
    
    SolvencyCheck -->|æ˜¯| UpdateRate[ğŸ“Š æ›´æ–°æ±‡ç‡]
    UpdateRate --> CheckSolvent{ğŸ” _isSolventæ£€æŸ¥}
    CheckSolvent -->|é€šè¿‡| End[âœ… æ‰§è¡ŒæˆåŠŸ]
    CheckSolvent -->|å¤±è´¥| Revert1[âŒ Revert: user insolvent]
    
    SolvencyCheck -->|å¦| End
    
    style Start fill:#90EE90
    style End fill:#90EE90
    style Revert1 fill:#FF6B6B
    style Borrow fill:#FFD700
    style CheckSolvent fill:#FFD700
    style SetCheck1 fill:#FFA500
    style SetCheck2 fill:#FFA500
            </pre>
        </div>

        <h2 id="borrow-flow">3. ğŸ’° å€Ÿæ¬¾æµç¨‹è¯¦è§£ (ACTION_BORROW)</h2>
        <div class="danger">
            <strong>ğŸ”¥ æ¼æ´å…³é”®ï¼š</strong> è¿™æ˜¯æ”»å‡»è€…å®é™…åˆ©ç”¨çš„å‡½æ•°ã€‚POCä¸­è™½ç„¶æ ‡è®°ä¸º<code>ACTION_REPAY</code>ï¼Œä½†å®é™…è°ƒç”¨çš„æ˜¯<code>ACTION_BORROW=5</code>ã€‚
        </div>
        <div class="diagram">
            <pre class="mermaid">
sequenceDiagram
    participant User as ğŸ‘¤ ç”¨æˆ·/æ”»å‡»è€…
    participant Cauldron as ğŸ¦ Cauldron
    participant BentoBox as ğŸ’° BentoBox
    
    User->>Cauldron: cook([5, 0], values, [amount, address(this)])
    activate Cauldron
    
    Note over Cauldron: ACTION_BORROW = 5
    Cauldron->>Cauldron: _borrow(to, amount)
    
    rect rgb(255, 240, 240)
        Note over Cauldron: ğŸ”´ å…³é”®æ£€æŸ¥ç‚¹
        Cauldron->>Cauldron: âœ… CHECK 1: totalBorrow <= cap.total
        Cauldron->>Cauldron: ğŸš¨ CHECK 2: newBorrowPart <= cap.borrowPartPerAddress
        Note over Cauldron: âš ï¸ å¦‚æœé…ç½®è¿‡é«˜ï¼Œæ£€æŸ¥å½¢åŒè™šè®¾ï¼
        
        Cauldron->>Cauldron: _preBorrowAction(...)
        Note over Cauldron: âš ï¸ è¿™æ˜¯ç©ºå‡½æ•°ï¼æ²¡æœ‰ä»»ä½•æ£€æŸ¥ï¼
    end
    
    Cauldron->>Cauldron: userBorrowPart[user] = newBorrowPart
    
    Cauldron->>BentoBox: transfer(MIM, Cauldron, User, share)
    Note over BentoBox: ğŸ’¸ MIMè¢«è½¬ç»™æ”»å‡»è€…
    BentoBox-->>Cauldron: Transferå®Œæˆ
    
    Cauldron->>Cauldron: status.needsSolvencyCheck = true
    
    Note over Cauldron: ğŸ”¥ æœ€ç»ˆSolvencyæ£€æŸ¥
    Cauldron->>Cauldron: _isSolvent(user, exchangeRate)
    
    alt æŠµæŠ¼å“å……è¶³æˆ–æ£€æŸ¥è¢«ç»•è¿‡
        Cauldron-->>User: âœ… å€Ÿæ¬¾æˆåŠŸ
    else æŠµæŠ¼å“ä¸è¶³
        Cauldron-->>User: âŒ Revert: user insolvent
    end
    
    deactivate Cauldron
            </pre>
        </div>

        <h2 id="solvency">4. ğŸ”’ Solvencyæ£€æŸ¥æœºåˆ¶</h2>
        <div class="description">
            <code>_isSolvent()</code> å‡½æ•°æ£€æŸ¥ç”¨æˆ·çš„æŠµæŠ¼å“æ˜¯å¦è¶³å¤Ÿè¦†ç›–å€Ÿæ¬¾ã€‚è¿™æ˜¯åè®®çš„æœ€åä¸€é“é˜²çº¿ã€‚
        </div>
        <div class="warning">
            <strong>âš ï¸ ç»•è¿‡æ–¹å¼ï¼š</strong>
            <ul>
                <li>æä¾›å¾®é‡æŠµæŠ¼å“ï¼ˆå¦‚1 weiçš„æŸä¸ªä»£å¸ï¼‰</li>
                <li>åˆ©ç”¨Oracleä»·æ ¼å»¶è¿Ÿæˆ–æ“çºµ</li>
                <li><code>COLLATERIZATION_RATE</code>é…ç½®è¿‡ä½</li>
                <li>æŸäº›Cauldronç›´æ¥é…ç½®ä¸ºå…è®¸ä½æŠµæŠ¼ç‡</li>
            </ul>
        </div>
        <div class="diagram">
            <pre class="mermaid">
flowchart TD
    Start[ğŸ” _isSolventæ£€æŸ¥] --> GetBorrow[è·å–userBorrowPart]
    GetBorrow --> CheckBorrow{borrowPart == 0?}
    
    CheckBorrow -->|æ˜¯| ReturnTrue1[âœ… return true<br/>æ— å€Ÿæ¬¾=æ€»æ˜¯solvent]
    CheckBorrow -->|å¦| GetCollateral[è·å–userCollateralShare]
    
    GetCollateral --> CheckCollateral{collateralShare == 0?}
    CheckCollateral -->|æ˜¯| ReturnFalse[âŒ return false<br/>æœ‰å€Ÿæ¬¾æ— æŠµæŠ¼=insolvent]
    CheckCollateral -->|å¦| CalcValues[è®¡ç®—æŠµæŠ¼å“ä»·å€¼å’Œå€Ÿæ¬¾ä»·å€¼]
    
    CalcValues --> Compare{collateralValue<br/>>= borrowValue?}
    
    Compare -->|æ˜¯| ReturnTrue2[âœ… return true<br/>æŠµæŠ¼å“å……è¶³]
    Compare -->|å¦| ReturnFalse2[âŒ return false<br/>æŠµæŠ¼å“ä¸è¶³]
    
    style ReturnTrue1 fill:#90EE90
    style ReturnTrue2 fill:#90EE90
    style ReturnFalse fill:#FF6B6B
    style ReturnFalse2 fill:#FF6B6B
    style Compare fill:#FFD700
            </pre>
        </div>

        <h2 id="attack">5. ğŸš¨ æ”»å‡»å‘é‡åˆ†æ</h2>
        <div class="danger">
            <strong>ğŸ’€ æ”»å‡»è·¯å¾„ï¼š</strong> æ”»å‡»è€…é€šè¿‡è¯†åˆ«é…ç½®é”™è¯¯çš„Cauldronï¼Œåˆ©ç”¨è¿‡é«˜çš„å€Ÿæ¬¾é™é¢ã€ç©ºçš„_preBorrowActionå’Œå¯ç»•è¿‡çš„Solvencyæ£€æŸ¥ï¼Œåœ¨å•ç¬”äº¤æ˜“ä¸­çªƒå–$1.7Mã€‚
        </div>
        <div class="diagram">
            <pre class="mermaid">
flowchart TD
    Attacker[ğŸ‘¹ æ”»å‡»è€…] --> Recon[ğŸ” ä¾¦æŸ¥é˜¶æ®µ]
    
    Recon --> Check1{borrowPartPerAddress<br/>æ˜¯å¦è¿‡é«˜?}
    Check1 -->|æ˜¯| Check2{_preBorrowAction<br/>æ˜¯å¦ä¸ºç©º?}
    Check1 -->|å¦| NotVuln1[âŒ ä¸æ˜“å—æ”»å‡»]
    
    Check2 -->|æ˜¯| Check3{Solvencyæ£€æŸ¥<br/>å¯ç»•è¿‡?}
    Check2 -->|å¦| NotVuln2[âŒ ä¸æ˜“å—æ”»å‡»]
    
    Check3 -->|æ˜¯| Vulnerable[âœ… å‘ç°æ¼æ´!]
    Check3 -->|å¦| NotVuln3[âŒ ä¸æ˜“å—æ”»å‡»]
    
    Vulnerable --> Deploy[ğŸš€ éƒ¨ç½²æ”»å‡»åˆçº¦]
    Deploy --> Attack[âš”ï¸ æ”»å‡»æ‰§è¡Œ]
    
    Attack --> Loop[ğŸ”„ éå†6ä¸ªCauldron]
    Loop --> CallCook[è°ƒç”¨cook with ACTION_BORROW]
    
    CallCook --> Pass1[âœ… borrowPartPerAddressæ£€æŸ¥é€šè¿‡<br/>é™é¢è¿‡é«˜]
    Pass1 --> Pass2[âœ… _preBorrowActioné€šè¿‡<br/>ç©ºå‡½æ•°]
    Pass2 --> Pass3[âœ… _isSolventé€šè¿‡<br/>å¾®é‡æŠµæŠ¼å“]
    
    Pass3 --> GetMIM[ğŸ’° è·å¾—MIM share]
    GetMIM --> NextCauldron{è¿˜æœ‰æ›´å¤šCauldron?}
    
    NextCauldron -->|æ˜¯| Loop
    NextCauldron -->|å¦| Withdraw[ğŸ“¤ ä»BentoBoxæå–æ‰€æœ‰MIM]
    
    Withdraw --> Swap1[ğŸ”„ MIM â†’ 3CRV]
    Swap1 --> Swap2[ğŸ”„ 3CRV â†’ USDT]
    Swap2 --> Swap3[ğŸ”„ USDT â†’ WETH]
    Swap3 --> Success[ğŸ’° æ”»å‡»æˆåŠŸ!<br/>è·åˆ©$1.7M]
    
    style Attacker fill:#FF6B6B
    style Vulnerable fill:#FFD700
    style Success fill:#8B0000,color:#fff
    style Pass1 fill:#FFA500
    style Pass2 fill:#FFA500
    style Pass3 fill:#FFA500
            </pre>
        </div>

        <h2 id="repay">6. ğŸ’¸ è¿˜æ¬¾æµç¨‹ (ACTION_REPAY)</h2>
        <div class="success">
            <strong>â„¹ï¸ è¯´æ˜ï¼š</strong> è¿™æ˜¯æ­£å¸¸çš„è¿˜æ¬¾æµç¨‹ã€‚POCä¸­è™½ç„¶å£°ç§°ä½¿ç”¨ACTION_REPAYï¼Œä½†å®é™…ä¸Šæ”»å‡»è€…ä½¿ç”¨çš„æ˜¯ACTION_BORROWï¼ˆå€¼=5ï¼‰ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„ACTION_REPAYï¼ˆå€¼=2ï¼‰ã€‚
        </div>
        <div class="diagram">
            <pre class="mermaid">
flowchart LR
    User[ğŸ‘¤ ç”¨æˆ·] -->|ACTION_REPAY=2| Repay[_repayå‡½æ•°]
    Repay --> Sub[å‡å°‘userBorrowPart]
    Sub --> Transfer[BentoBox.transfer<br/>user â†’ Cauldron]
    Transfer --> Success[âœ… è¿˜æ¬¾æˆåŠŸ]
    
    style Success fill:#90EE90
    style Repay fill:#87CEEB
            </pre>
        </div>
        <div class="description">
            æ³¨æ„ï¼šè¿˜æ¬¾æ“ä½œ<strong>ä¸ä¼šè§¦å‘</strong> <code>needsSolvencyCheck</code>ï¼Œå› ä¸ºè¿˜æ¬¾åªä¼šæ”¹å–„ç”¨æˆ·çš„æŠµæŠ¼ç‡ï¼Œä¸ä¼šæ¶åŒ–ã€‚
        </div>

        <h2 id="comparison">7. âš–ï¸ æ­£å¸¸vsæ”»å‡»åœºæ™¯å¯¹æ¯”</h2>
        <div class="diagram">
            <pre class="mermaid">
flowchart TD
    subgraph Normal[ğŸ’š æ­£å¸¸å€Ÿæ¬¾åœºæ™¯]
        N1[ç”¨æˆ·å­˜å…¥å……è¶³æŠµæŠ¼å“<br/>æŠµæŠ¼ç‡ >= 150%] --> N2[è°ƒç”¨borrow<br/>åˆç†é‡‘é¢]
        N2 --> N3[âœ… borrowPartPerAddress<br/>é€šè¿‡]
        N3 --> N4[âœ… _preBorrowAction<br/>é€šè¿‡]
        N4 --> N5[âœ… _isSolventæ£€æŸ¥<br/>150%æŠµæŠ¼ç‡é€šè¿‡]
        N5 --> N6[âœ… è·å¾—å€Ÿæ¬¾<br/>æ­£å¸¸ä½¿ç”¨]
    end
    
    subgraph Attack[ğŸ’€ æ”»å‡»åœºæ™¯]
        A1[æ”»å‡»è€…æ— /å¾®é‡æŠµæŠ¼å“<br/>æŠµæŠ¼ç‡ 0-10%] --> A2[è°ƒç”¨cook with ACTION_BORROW<br/>æœ€å¤§é‡‘é¢]
        A2 --> A3[âœ… borrowPartPerAddress<br/>é…ç½®è¿‡é«˜-é€šè¿‡!]
        A3 --> A4[âœ… _preBorrowAction<br/>ç©ºå‡½æ•°-é€šè¿‡!]
        A4 --> A5[âœ… _isSolventæ£€æŸ¥<br/>è¢«ç»•è¿‡-é€šè¿‡!]
        A5 --> A6[ğŸ’€ çªƒå–å¤§é‡MIM<br/>$1.7M]
    end
    
    style N6 fill:#90EE90
    style A6 fill:#8B0000,color:#fff
    style A3 fill:#FFD700
    style A4 fill:#FFD700
    style A5 fill:#FFD700
            </pre>
        </div>

        <div class="danger">
            <h3>ğŸ”¥ å…³é”®å·®å¼‚</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <tr style="background: #f0f0f0;">
                    <th style="padding: 10px; border: 1px solid #ddd;">æ£€æŸ¥é¡¹</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">æ­£å¸¸åœºæ™¯</th>
                    <th style="padding: 10px; border: 1px solid #ddd;">æ”»å‡»åœºæ™¯</th>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>æŠµæŠ¼å“</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">å……è¶³ï¼ˆ150%+ï¼‰</td>
                    <td style="padding: 10px; border: 1px solid #ddd; background: #ffebee;">æ— æˆ–æå°‘ï¼ˆ0-10%ï¼‰</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>å€Ÿæ¬¾é‡‘é¢</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">åˆç†èŒƒå›´å†…</td>
                    <td style="padding: 10px; border: 1px solid #ddd; background: #ffebee;">æœ€å¤§åŒ–ï¼ˆæç©ºCauldronï¼‰</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>borrowPartPerAddress</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">é™åˆ¶æœ‰æ•ˆ</td>
                    <td style="padding: 10px; border: 1px solid #ddd; background: #ffebee;">é…ç½®è¿‡é«˜ï¼Œå½¢åŒè™šè®¾</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>_preBorrowAction</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">é€šè¿‡ï¼ˆç©ºå‡½æ•°ï¼‰</td>
                    <td style="padding: 10px; border: 1px solid #ddd; background: #ffebee;">é€šè¿‡ï¼ˆç©ºå‡½æ•°ï¼ï¼‰</td>
                </tr>
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>_isSolvent</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">é€šè¿‡ï¼ˆå……è¶³æŠµæŠ¼ï¼‰</td>
                    <td style="padding: 10px; border: 1px solid #ddd; background: #ffebee;">è¢«ç»•è¿‡ï¼ˆå¾®é‡æŠµæŠ¼/é…ç½®é”™è¯¯ï¼‰</td>
                </tr>
            </table>
        </div>

        <div class="success">
            <h3>âœ… å®‰å…¨å»ºè®®</h3>
            <ol>
                <li><strong>åˆç†è®¾ç½®å€Ÿæ¬¾é™é¢ï¼š</strong> <code>borrowPartPerAddress</code>åº”è¯¥åŸºäºåè®®TVLå’Œé£é™©è¯„ä¼°åŠ¨æ€è°ƒæ•´</li>
                <li><strong>å®ç°_preBorrowActionï¼š</strong> ä¸åº”è¯¥æ˜¯ç©ºå‡½æ•°ï¼Œè‡³å°‘è¦æ£€æŸ¥æŠµæŠ¼å“å­˜åœ¨æ€§</li>
                <li><strong>å¢å¼ºSolvencyæ£€æŸ¥ï¼š</strong> æ·»åŠ æœ€ä½æŠµæŠ¼ç‡è¦æ±‚ï¼ˆå¦‚125%ï¼‰ï¼Œä¸èƒ½ä»…ä¾èµ–é…ç½®å‚æ•°</li>
                <li><strong>æ·»åŠ é€Ÿç‡é™åˆ¶ï¼š</strong> é™åˆ¶å•ç¬”äº¤æ˜“çš„å€Ÿæ¬¾é‡‘é¢å’Œé¢‘ç‡</li>
                <li><strong>ä½¿ç”¨å¯é çš„Oracleï¼š</strong> ç¡®ä¿ä»·æ ¼æ•°æ®åŠæ—¶å‡†ç¡®ï¼Œè€ƒè™‘ä½¿ç”¨å¤šä¸ªæ•°æ®æº</li>
                <li><strong>å®æ–½ç´§æ€¥æš‚åœï¼š</strong> æ‰€æœ‰å…³é”®å‡½æ•°éƒ½åº”æœ‰æš‚åœå¼€å…³</li>
                <li><strong>å…¨é¢çš„æµ‹è¯•ï¼š</strong> åŒ…æ‹¬è¾¹ç•Œæƒ…å†µã€æé™å€Ÿæ¬¾ã€é›¶æŠµæŠ¼ç­‰åœºæ™¯</li>
            </ol>
        </div>

        <hr style="margin: 40px 0; border: 2px solid #667eea;">

        <div style="text-align: center; color: #666; margin-top: 30px;">
            <p><strong>æ–‡æ¡£ç‰ˆæœ¬ï¼š</strong> 1.0</p>
            <p><strong>ç”Ÿæˆæ—¶é—´ï¼š</strong> 2025-10-12</p>
            <p><strong>åŸºäºï¼š</strong> Cauldron V4 å®é™…åˆçº¦æºä»£ç åˆ†æ</p>
            <p><strong>æ¡ˆä¾‹ï¼š</strong> MIMSpell3 æ”»å‡» ($1.7MæŸå¤±)</p>
            <p style="margin-top: 20px; font-size: 0.9em;">
                âš ï¸ æœ¬æ–‡æ¡£ä»…ä¾›å®‰å…¨ç ”ç©¶å’Œæ•™è‚²ç›®çš„ä½¿ç”¨
            </p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                fontSize: '16px'
            }
        });
    </script>
</body>
</html>

